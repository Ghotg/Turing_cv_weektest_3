# 题目5：综合项目 - 交通车辆检测与流量分析系统

## 项目背景

智能交通系统是现代城市管理的重要组成部分。本项目要求开发一个交通车辆检测与流量分析系统，通过计算机视觉技术对道路图像进行分析，实现车辆识别、计数和流量统计。这是一个真实的应用场景，在智慧城市、交通管理、停车场管理等领域有广泛应用。

## 项目目标

开发一个智能交通分析系统，实现以下功能：
1. 自动检测和识别图像中的车辆
2. 统计车辆数量和分布密度
3. 分析车辆大小特征（用于区分车型）
4. 生成可视化的交通流量分析报告
5. 为交通管理决策提供数据支持

## 任务要求

请开发一个完整的交通车辆检测与分析系统，实现以下功能：

### 第一阶段：图像采集与预处理
1. 读取交通场景图像 `traffic.jpg`（包含道路上的多辆车辆）
2. 图像质量增强：
   - 转换为灰度图
   - 直方图均衡化提升对比度
   - 高斯模糊降噪
3. 保存预处理后的图像用于对比

### 第二阶段：车辆检测与分割
4. 使用自适应阈值或 Canny 边缘检测识别车辆边缘
5. 形态学处理优化检测结果：
   - 闭运算连接车辆的断裂边缘
   - 开运算去除道路标记等干扰
6. 轮廓检测提取车辆候选区域

### 第三阶段：车辆识别与特征提取
7. 过滤无效检测（基于面积、长宽比等特征）
8. 统计车辆总数
9. 使用 Numpy 提取每辆车的特征：
   - 车辆面积（用于区分小型车、中型车、大型车）
   - 边界框尺寸（长度和宽度）
   - 位置坐标（用于流量密度分析）
10. 在原图上标注每辆车：
    - 绘制边界框
    - 标注车辆编号
    - 根据车辆大小用不同颜色标识车型

### 第四阶段：交通流量数据分析
11. 使用 Numpy 进行数据统计：
    - 计算车辆总数和不同车型的数量
    - 统计车辆面积的分布特征
    - 计算道路的车辆密度
    - 分析车辆在图像中的空间分布
12. 车型分类（基于面积）：
    - 小型车：面积 < 平均值 - 0.5×标准差
    - 中型车：平均值 ± 0.5×标准差
    - 大型车：面积 > 平均值 + 0.5×标准差

### 第五阶段：可视化报告生成
13. 使用 Matplotlib 创建综合分析报告（2×3 子图布局）：
    - 原始交通图像
    - 预处理后的图像
    - 边缘检测结果
    - 车辆检测标注图
    - 车辆面积分布直方图（区分车型）
    - 车型占比饼图
14. 添加详细的数据标注和图例说明

### 第六阶段：结果输出与报告
15. 保存标注后的检测结果图像：`traffic_detected.jpg`
16. 保存完整的分析报告：`traffic_analysis_report.png`
17. 生成文字版分析报告，包含：
    - 车辆总数统计
    - 不同车型的数量和占比
    - 道路拥堵程度评估
    - 流量分析建议

## 准备工作

请准备一张交通场景测试图片 `traffic.jpg`，要求：
- 包含道路和多辆车辆（建议 5-20 辆）
- 拍摄角度：俯视或斜俯视效果最佳
- 建议场景：停车场、高速公路、城市道路等
- 可从网上下载交通监控图像或自行拍摄
- 确保图像清晰，车辆轮廓可辨识

## 评分要点

1. **图像预处理**（15分）：直方图均衡化、降噪等预处理技术的正确应用
2. **车辆检测**（20分）：准确的边缘检测、形态学处理和轮廓提取
3. **特征提取与分析**（20分）：车辆特征提取、车型分类的合理性
4. **数据统计**（15分）：使用 Numpy 进行准确的数据分析和计算
5. **可视化报告**（20分）：多子图布局、直方图、饼图等可视化效果
6. **系统完整性**（10分）：项目流程完整，输出结果规范

## 技术提示

### OpenCV 图像处理
- `cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)` - 灰度转换
- `cv2.equalizeHist(gray)` - 直方图均衡化
- `cv2.GaussianBlur(gray, (5, 5), 0)` - 高斯模糊降噪
- `cv2.Canny(blurred, threshold1, threshold2)` - Canny边缘检测
- `cv2.adaptiveThreshold()` - 自适应阈值
- `cv2.morphologyEx()` - 形态学操作（闭运算、开运算）
- `cv2.findContours()` - 轮廓检测
- `cv2.contourArea()` - 计算轮廓面积
- `cv2.boundingRect()` - 获取边界框
- `cv2.rectangle()` - 绘制矩形框
- `cv2.putText()` - 添加文字标注

### Numpy 数据分析
- 特征提取：面积、长宽比、位置等
- 统计分析：`np.mean()`, `np.std()`, `np.min()`, `np.max()`
- 数组过滤和分类
- 车辆密度计算

### Matplotlib 可视化
- `plt.subplot()` 或 `plt.subplots()` - 创建多子图（2×3布局）
- `plt.imshow()` - 显示图像
- `plt.hist()` - 绘制直方图（车辆面积分布）
- `plt.pie()` - 绘制饼图（车型占比）
- `plt.text()` - 添加数据标注
- `plt.legend()` - 添加图例

## 项目亮点

1. **实际应用价值**：可应用于智能交通、停车场管理、道路监控等场景
2. **技术综合性**：完整展示图像处理、数据分析、可视化的工作流程
3. **分析深度**：不仅检测车辆，还进行车型分类和流量分析
4. **报告专业性**：生成专业的数据分析报告

## 扩展方向（选做）

1. **车辆追踪**：如果有视频流，如何实现车辆的跨帧追踪？
2. **速度估算**：根据连续帧图像，如何估算车辆行驶速度？
3. **异常检测**：如何检测逆行、违停等异常交通行为？
4. **拥堵分析**：如何量化道路拥堵程度，提出交通优化建议？
5. **深度学习集成**：如何结合 YOLO 等深度学习模型提升检测精度？
